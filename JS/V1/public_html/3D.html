<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="bootstrap.min.css" rel="stylesheet">
        <title>3D bathymetry</title>
    </head>
    <body>
        <main class="container-fluid">
            <div class="row mt-2">
                <div class="col-2">
                    <div class="row">
                        <div class="col">
                            <b>
                                3D bathymetry 
                                <span id="bathymetry__points_count"></span>
                            </b>
                        </div>                
                    </div>
                    <div class="row">                        
                        <div class="col-auto mb-1"> 
                            <input type="number" id="form_bathymetry__depth_min_input" placeholder="Min depth, m" value="0.5" class="form-control d-inline-block form-control-sm" style="width: 90px">
                            <input type="number" id="form_bathymetry__depth_max_input" placeholder="Max depth, m" value="5" class="form-control d-inline-block form-control-sm" style="width: 90px">
                        </div>
                        <div class="col-auto mb-1">
                            <textarea id="form_bathymetry__data_input" class="form-control form-control-sm" style="width: 90px; height: 16px;" placeholder="Logic log"></textarea> 
                        </div>
                        <div class="col-auto mb-1">
                            <span id="form_bathymetry__btn_ok" class="btn btn-success btn-sm">Ok</span>
                        </div>
                    </div> 
                    <div class="row mt-5">
                        <div class="col">
                            <div class="d-block">
                                <b>Захват сечения</b><br>
                                ±Ш.(lat) <input type="number" class="form-control d-inline-block form-control-sm" min="0" value="0.00001" id="sonar__section_dLat" style="width: 90px">                                 
                                <br>
                                ±Д.(lng) <input type="number" class="form-control d-inline-block form-control-sm" min="0" value="0.00001" id="sonar__section_dLng" style="width: 90px">   
                                <br>                                 
                                <input type="radio" name="sonar__section_isVertical" value="0" checked> --- &nbsp;&nbsp;
                                <input type="radio" name="sonar__section_isVertical" value="1"> | 
                                <br>
                                <span id="sonar__section_ok" class="btn btn-success btn-sm">Начать</span>   
                            </div>
                        </div>
                    </div>
                    <div class="row mt-5">
                        <div class="col">
                            <div class="d-block">
                                <b>Глубина</b><br>
                                <div id="sonar__palette_depth_min_text" class="d-inline-block" style="width: 50px;"></div>
                                <div class="d-inline-block"><div id="sonar__palette_depth"></div></div>
                                <div id="sonar__palette_depth_max_text" class="d-inline-block"></div>
                            </div>
                            <div class="d-block mt-3">
                                <input id="sonar__over_bottom" type="checkbox" checked> В толще воды  
                                <!--input id="sonar__full_bottom" type="checkbox" checked> bottom  &nbsp;&nbsp;&nbsp;-->
                            </div>
                            <div class="d-block">
                                <input id="sonar__circles" type="checkbox" checked> Точки  
                            </div>
                            <div class="d-block mt-3">
                                <b>Мощность отражений</b><br>
                                <input type="range" class="form-range" min="0" max="3000" value="0" id="sonar__range_pulse_w_min_show" title="Мощность отраженок, скрыть слабые"> 
                                скрыть слабее <span id="sonar__range_pulse_w_min_show_val"></span>
                            </div>
                            <div class="d-block mt-3">
                                <div class="d-block">
                                    <b>Мощность отражений: палитра</b><br>
                                    <div class="d-block">
                                        <input id="sonar__palette_power_isBW" type="checkbox" checked> BW \ RGB  
                                    </div>
                                    <input type="range" class="form-range" min="0" max="3000" value="2000" id="sonar__range_pulse_w_max" title="Мощность отраженок MAX для палитры"> 
                                </div>
                                <div class="d-block align-middle"> 
                                    <span id="sonar__range_pulse_w_min_val">0mks</span> 
                                    <div class="d-inline-block align-middle">
                                        <div class="d-block"><div id="sonar__palette_power_rgb"></div></div>
                                        <div class="d-block"><div id="sonar__palette_power_bw"></div></div>
                                    </div>
                                    <span id="sonar__range_pulse_w_max_val"></span>
                                </div>                                
                            </div>
                            <div class="d-block mt-3" style="font-size: 12px;">
                                <b>Углы</b><br>
                                Ш.(lat) min=<span id="sonar__info_latMin"></span>                                
                                <br>
                                Ш.(lat) max=<span id="sonar__info_latMax"></span>                                
                                <br>
                                Д.(lng) min=<span id="sonar__info_lngMin"></span>                                
                                <br>
                                Д.(lng) max=<span id="sonar__info_lngMax"></span>                                
                                <br>
                            </div>
                            <div class="d-block mt-3" style="font-size: 12px;">
                                <b>В толще воды</b><br>
                                Наведение на точку или импульс: покажет отражения в толще воды, глубину, начало отражения ото дна pulseRising мкс, ширину пульса pulseWidth мкс.                                
                            </div>
                        </div>
                    </div> 
                </div> 
                <div class="col-10">                      
                    <div id="sonar__section_block"></div>  
                    <div id="sonar__3D_block"></div>
                </div>                
            </div>  


            <script>
                let sonar__3D_pointsLatLng = [];
                //
                let sonar__section_pointsLatLng_clicked = [];
                let sonar__section_isVertical = false;
                let sonar__section_dLat = 0;
                let sonar__section_dLng = 0;
                //
                let sonar__depth_min = 0;
                let sonar__depth_max = 0;
                let depth_min_allow = 0;
                let depth_max_allow = 0;
                let sonar__dataItemsCount = 0;
                const sonar__colors_depth = [
                    '#f51c03',
                    '#f45202',
                    '#f38802',
                    '#f2be01',
                    '#f1f501',
                    '#bde708',
                    '#89da0f',
                    '#55cd16',
                    '#21c01d',
                    '#20ad31',
                    '#1f9a45',
                    '#1e8759',
                    '#00d9ff',
                    '#109df5',
                    '#2061ec',
                    '#3125e3'
                ];
                let sonar__lat_min = 999, sonar__lng_min = 999, sonar__lat_max = 0, sonar__lng_max = 0;
                let sonar__getColor_depth_m_dx = 1;
                let sonar__mks2px_fullScale_dx = 1;
                const sonar__pulses_block_h_px = 100;
                const sonar__mks2m = 1367.0;
                const sonar__pulse_w_px = 8; //px;
                const sonar__pulse_w_offset_coef = 0.8 * 0.000001;
                const sonar__palette_power_rgb = [
                    '#0011fa',
                    '#016efa',
                    '#03cbfa',
                    '#009716',
                    '#45c80c',
                    '#8afa03',
                    '#fa8803',
                    '#fa4503',
                    '#fa0303'
                ]; //9                    
                const sonar__palette_power_bw = [
                    '#f0f1f5',
                    '#d2d3d7',
                    '#b5b6b9',
                    '#97989b',
                    '#7a7b7d',
                    '#5d5d5f',
                    '#3f4041',
                    '#222223',
                    '#050505'
                ]; //9                
                let sonar__colors_power_dx = (2000 - 0) / sonar__palette_power_rgb.length; //default, change by input-range
                let sonar__colors_power_isBW = true;


                document.addEventListener('DOMContentLoaded', function () {
                    sonar__palettes();
                    sonar__actions();
                });

                function sonar__actions() {
                    $('#form_bathymetry__btn_ok').click(() => {
                        sonar__bathymetryProcess();
                    });
                    $('#sonar__over_bottom').change(() => {
                        if ($('#sonar__over_bottom').is(":checked")) {
                            $('div.logic_pulsesOverBottom_block').show();
                        } else {
                            $('div.logic_pulsesOverBottom_block').hide();
                        }
                    });
                    $('#sonar__full_bottom').change(() => {
                        if ($('#sonar__full_bottom').is(":checked")) {
                            $('div.logic_pulsesFull_block').show();
                        } else {
                            $('div.logic_pulsesFull_block').hide();
                        }
                    });
                    $('#sonar__circles').change(() => {
                        if ($('#sonar__circles').is(":checked")) {
                            $('div.sonar__circles').show();
                        } else {
                            $('div.sonar__circles').hide();
                        }
                    });
                    $('#sonar__range_pulse_w_min_show').change(() => {
                        const pulseW_mks = parseInt($('#sonar__range_pulse_w_min_show').val()) || 0;
                        if ($('#sonar__over_bottom').is(":checked")) {
                            $('div.logic_pulseOverBottom').show().filter(function () {
                                return $(this).attr('w_mks') < pulseW_mks;
                            }).hide();
                        }
                        if ($('#sonar__full_bottom').is(":checked")) {
                            $('div.logic_pulseFull').show().filter(function () {
                                return $(this).attr('w_mks') < pulseW_mks;
                            }).hide();
                        }
                        $('div.sonar__2D_pulse').show().filter(function () {
                            return $(this).attr('w_mks') < pulseW_mks;
                        }).hide();

                        $('#sonar__range_pulse_w_min_show_val').html(pulseW_mks + 'mks');
                    });
                    $('#sonar__palette_power_isBW').change(() => {
                        sonar__colors_power_isBW = $('#sonar__palette_power_isBW').is(":checked");
                        sonar__pulses_setColor();
                    });
                    $('#sonar__range_pulse_w_max').change(() => {
                        const pulseW_mks = parseInt($('#sonar__range_pulse_w_max').val()) || 0;
                        sonar__colors_power_dx = (pulseW_mks - 0) / sonar__palette_power_rgb.length;
                        $('#sonar__range_pulse_w_max_val').html(pulseW_mks + 'mks');
                        sonar__pulses_setColor();
                    });

                    $('#sonar__section_ok').click(() => {
                        sonar__section_begin();
                    });
                }


                function sonar__pulses_setColor() {
                    $('div.sonar__2D_pulse').each(function () {
                        const w_mks = parseInt($(this).attr('w_mks')) || 0;
                        $(this).css('background-color', sonar__getColor_power_mks(w_mks, sonar__colors_power_isBW));
                    });
                    $('div.logic_pulseOverBottom').each(function () {
                        const w_mks = parseInt($(this).attr('w_mks')) || 0;
                        $(this).css('background-color', sonar__getColor_power_mks(w_mks, sonar__colors_power_isBW));
                    });
                    if (sonar__colors_power_isBW) {
                        $('div.sonar__2D_pulse').css('opacity', 0.6);
                        //$('div.logic_pulseOverBottom').css('opacity', 0.6);
                    } else {
                        $('div.sonar__2D_pulse').css('opacity', 1);
                        //$('div.logic_pulseOverBottom').css('opacity', 1);
                    }
                }

                function sonar__getPulse_w_realBottom_mks_min(depth_mks) {
                    if (depth_mks < 1500) {
                        return 1200;
                    }
                    if (depth_mks < 3000) {
                        return 2500;
                    }
                    return 2600;
                }

                function sonar__bathymetryProcess() {
                    sonar__3D_pointsLatLng = [];
                    sonar__depth_min = 0;
                    sonar__depth_max = 0;
                    depth_min_allow = parseFloat($('#form_bathymetry__depth_min_input').val()) || 0;
                    depth_max_allow = parseFloat($('#form_bathymetry__depth_max_input').val()) || 0;

                    const lines = $('#form_bathymetry__data_input').val().split(/\n/);
                    for (const line of lines) {
                        let pulses = [];
                        let RR = [], FF = [];
                        const raw = line.split(';');

                        for (var i = 1; i <= 16; i++) {
                            const mks = parseInt(raw[i]) || 0;
                            if (mks > 0) {
                                RR.push(mks);
                            }
                        }
                        for (var i = 18; i <= 33; i++) {
                            const mks = parseInt(raw[i]) || 0;
                            if (mks > 0) {
                                FF.push(mks);
                            }
                        }
                        if (RR.length <= 0) {
                            continue; //goto next line
                        }

                        //find widths of pulses and add to pulses-array
                        for (const R of RR) {
                            for (const F of FF) {
                                if (R < F) {
                                    w_mks = F - R;
                                    const pulse = {
                                        R: R,
                                        F: F,
                                        W: (F - R)
                                    };
                                    pulses.push(pulse);
                                    break;
                                }
                            }
                        }

                        let depth_mks = 0;
                        for (const pulse of pulses) {
                            const pulse_w_realBottom_mks_min = sonar__getPulse_w_realBottom_mks_min(pulse.R);
                            if (pulse.W >= pulse_w_realBottom_mks_min) {
                                depth_mks = pulse.R;
                                break;
                            }
                        }

                        //3D
                        const lat = parseFloat(raw[34]) || 0;
                        const lng = parseFloat(raw[35]) || 0;
                        let depthM = depth_mks / sonar__mks2m;
                        if (lat > 0 && lng > 0 && depthM >= depth_min_allow && depthM <= depth_max_allow) {
                            //const lat5 = Math.round(lat * 100000) / 100000;
                            //const lng5 = Math.round(lng * 100000) / 100000;
                            const idx = lat + '_' + lng;
                            if (sonar__3D_pointsLatLng.hasOwnProperty(idx)) {
                                //console.log('double1', depthM, sonar__3D_pointsLatLng[idx].depthM);
                                //console.log('double2', pulses, sonar__3D_pointsLatLng[idx].pulses);
                                depthM = (sonar__3D_pointsLatLng[idx].depthM + depthM) / 2.0;
                                pulses = pulses.concat(sonar__3D_pointsLatLng[idx].pulses);
                            }
                            let point = {
                                depthM: depthM,
                                depth_mks: depth_mks,
                                pulses: pulses
                            };
                            sonar__3D_pointsLatLng[idx] = point;

                            if (sonar__depth_min > depthM) {
                                sonar__depth_min = depthM;
                            }
                            if (sonar__depth_max < depthM) {
                                sonar__depth_max = depthM;
                            }

                            if (sonar__lat_min > lat) {
                                sonar__lat_min = lat;
                            }
                            if (sonar__lng_min > lng) {
                                sonar__lng_min = lng;
                            }
                            if (sonar__lat_max < lat) {
                                sonar__lat_max = lat;
                            }
                            if (sonar__lng_max < lng) {
                                sonar__lng_max = lng;
                            }

                            sonar__dataItemsCount++;
                        }


                    } // one line

                    //all lines processed
                    $('#sonar__info_latMin').html(sonar__lat_min);
                    $('#sonar__info_latMax').html(sonar__lat_max);
                    $('#sonar__info_lngMin').html(sonar__lng_min);
                    $('#sonar__info_lngMax').html(sonar__lng_max);

                    $('#bathymetry__points_count').html(sonar__dataItemsCount + ' points');
                    $('#sonar__palette_depth_min_text').html(Math.round(sonar__depth_min * 100) / 100 + 'm');
                    $('#sonar__palette_depth_max_text').html(Math.round(sonar__depth_max * 100) / 100 + 'm');

                    sonar__getColor_depth_m_dx = (sonar__depth_max - sonar__depth_min) / sonar__colors_depth.length;
                    sonar__mks2px_fullScale_dx = (depth_max_allow * sonar__mks2m) / sonar__pulses_block_h_px;

                    for (let index in sonar__3D_pointsLatLng) {
                        const ll = index.split(/_/);
                        const lat_curr = parseFloat(ll[0]) || 0;
                        const lng_curr = parseFloat(ll[1]) || 0;
                        sonar__3D_point(lat_curr, lng_curr, sonar__3D_pointsLatLng[index]);
                    }
                }


                function sonar__section_begin() {
                    $('#sonar__section_block').html('');
                    sonar__section_pointsLatLng_clicked = [];
                    sonar__section_isVertical = parseInt($('input[name="sonar__section_isVertical"]:checked').val()) === 1 ? true : false;
                    sonar__section_dLat = parseFloat($('#sonar__section_dLat').val()) || 0;
                    sonar__section_dLng = parseFloat($('#sonar__section_dLng').val()) || 0;

                    $('div.logic_pulsesOverBottom_block').unbind('click').click(function () {
                        const lat = parseFloat($(this).attr('lat')) || 0;
                        const lng = parseFloat($(this).attr('lng')) || 0;
                        const idx = lat + '_' + lng;
                        sonar__section_pointsLatLng_clicked[idx] = 1;
                        sonar__section_draw(lat, lng); //добавим точку, в окрестности которой будем искать 

                        //todo draw red RECT +_ dlat dlong in 3D-points-block in selected lat-long
                    });
                }

                function sonar__section_draw(lat, lng) {
                    if (lat < 1 || lng < 1) {
                        return;
                    }
                    for (let index in sonar__3D_pointsLatLng) {
                        const ll = index.split(/_/);
                        const lat_curr = parseFloat(ll[0]) || 0;
                        const lng_curr = parseFloat(ll[1]) || 0;
                        const dLat = Math.abs(lat_curr - lat);
                        const dLng = Math.abs(lng_curr - lng);
                        if (dLat <= sonar__section_dLat && dLng <= sonar__section_dLng) {
                            $('#sonar__section_block').append(sonar__2D_point(lat_curr, lng_curr, sonar__3D_pointsLatLng[index]));
                        }
                    }

                    //hide weak signals
                    const pulseW_mks = parseInt($('#sonar__range_pulse_w_min_show').val()) || 0;
                    $('div.sonar__2D_pulse').show().filter(function () {
                        return $(this).attr('w_mks') < pulseW_mks;
                    }).hide();
                }
                function sonar__2D_point(lat, lng, data) {
                    const depth_color = sonar__getColor_depth_m(data.depthM);
                    const left_px = sonar__section_isVertical ? sonar__getOffsetLat_px(lat) : sonar__getOffsetLng_px(lng);
                    let mt_px = 5 + sonar__mks2px_fullScale(data.depth_mks, sonar__depth_max * sonar__mks2m);

                    let html = '<div class="sonar__2D_pulseBottom" title="' + (Math.round(data.depthM * 100) / 100) + 'm" lat="' + lat + '" lng="' + lng + '" style="left:' + left_px + 'px; top:' + mt_px + 'px; background-color:' + depth_color + '; width:' + sonar__pulse_w_px + 'px; "></div>';
                    for (const pulse of data.pulses) {
                        if (pulse.R >= (data.depth_mks - 100)) {
                            continue; //only fish over bottom                            
                        }
                        const pulse_color = sonar__getColor_power_mks(pulse.W, sonar__colors_power_isBW);
                        mt_px = sonar__mks2px_fullScale(pulse.R);
                        html += '<div class="sonar__2D_pulse" title="' + (Math.round((pulse.R / sonar__mks2m) * 100) / 100) + 'm R=' + pulse.R + ' W=' + pulse.W + '" w_mks="' + pulse.W + '" style="left:' + left_px + 'px; top:' + mt_px + 'px; width:' + (sonar__pulse_w_px - 2) + 'px; background-color:' + pulse_color + '; z-index:' + pulse.W + '; "></div>';
                    }
                    return html;
                }

                function sonar__3D_point(lat, lng, data) {
                    const depth_color = sonar__getColor_depth_m(data.depthM);
                    const left_px = sonar__getOffsetLng_px(lng);
                    const top_px = sonar__getOffsetLat_px(lat);

                    let html = '<div title="' + (Math.round((data.depthM) * 100) / 100) + 'm" class="logic_pulsesOverBottom_block" lat="' + lat + '" lng="' + lng + '" style="left:' + left_px + 'px; top:' + top_px + 'px; border-bottom: ' + sonar__pulse_w_px + 'px solid ' + depth_color + '; width:' + sonar__pulse_w_px + 'px; ">';
                    for (const pulse of data.pulses) {
                        if (pulse.R >= (data.depth_mks - 100)) {
                            continue; //only fish over bottom                            
                        }
                        pulse_color = sonar__getColor_power_mks(pulse.W, sonar__colors_power_isBW); //fish over bottom                         
                        let mt_px = sonar__mks2px_fullScale(pulse.R + (sonar__depth_max - data.depthM) * sonar__mks2m); //прижмем ко дну, а не к поверхности
                        html += '<div class="logic_pulseOverBottom" title="' + (Math.round((pulse.R / sonar__mks2m) * 100) / 100) + 'm R=' + pulse.R + ' W=' + pulse.W + '" w_mks="' + pulse.W + '" style="top:' + mt_px + 'px; width:' + (sonar__pulse_w_px - 2) + 'px; background-color:' + pulse_color + '; "></div>';
                    }
                    html += '</div>';

                    /*html += '<div class="logic_pulsesFull_block" lat="' + lat + '" lng="' + lng + '" style="left:' + left_px + 'px; top:' + top_px + 'px; box-shadow: 0px 10px 0px -2px ' + depth_color + '; width:' + sonar__pulse_w_px + 'px; ">';
                     for (const pulse of data.pulses) {
                     let pulse_opacity, pulse_color;
                     if (pulse.R >= (data.depth_mks - 100)) {
                     pulse_color = depth_color; //bottom and under
                     pulse_opacity = 1;
                     } else {
                     pulse_color = sonar__getColor_power_mks(pulse.W, true); //fish over bottom  
                     pulse_opacity = 1;
                     }
                     let mt_px = sonar__mks2px_fullScale(pulse.R);
                     let h_px = Math.max(sonar__mks2px_fullScale(pulse.W + pulse.R) - mt_px, 2);
                     html += '<div class="logic_pulseFull" title="R=' + pulse.R + ' W=' + pulse.W + ' ' + (Math.round((pulse.R / sonar__mks2m) * 100) / 100) + 'm" w_mks="' + pulse.W + '" style="top:' + mt_px + 'px; height:' + h_px + 'px; width:' + (sonar__pulse_w_px - 2) + 'px; background-color:' + pulse_color + '; opacity: ' + pulse_opacity + ' "></div>';
                     }
                     html += '</div>';*/

                    html += '<div class="sonar__circles" title="' + (Math.round(data.depthM * 100) / 100) + 'm" style="left:' + left_px + 'px; top:' + top_px + 'px; background-color:' + depth_color + '; width:' + sonar__pulse_w_px + 'px; height:' + sonar__pulse_w_px + 'px; ">';
                    html += '</div>';

                    $('#sonar__3D_block').append(html);
                }


                function sonar__getColor_depth_m(m) {
                    let idx = Math.round(m / sonar__getColor_depth_m_dx);
                    idx = Math.min(Math.max(parseInt(idx), 0), (sonar__colors_depth.length - 1)); //constrain from to
                    return sonar__colors_depth[idx];
                }

                function sonar__getColor_power_mks(mks, isWB) {
                    let idx = Math.round(mks / sonar__colors_power_dx);
                    idx = Math.min(Math.max(parseInt(idx), 0), (sonar__palette_power_rgb.length - 1)); //constrain from to
                    return isWB ? sonar__palette_power_bw[idx] : sonar__palette_power_rgb[idx];
                }

                /*function sonar__mks2px(mks, point_depth_mks) {
                 const sonar__mks2px_dx = point_depth_mks / sonar__pulses_block_h_px;
                 let px = Math.round(mks / sonar__mks2px_dx);
                 px = Math.min(Math.max(px, 0), sonar__pulses_block_h_px); //constrain from to
                 return px;
                 }*/
                function sonar__mks2px_fullScale(mks) {
                    let px = Math.round(mks / sonar__mks2px_fullScale_dx);
                    px = Math.min(Math.max(px, 0), sonar__pulses_block_h_px); //constrain from to
                    return px;
                }

                function sonar__getOffsetLat_px(lat) {
                    let px = Math.round((sonar__lat_max - lat) / sonar__pulse_w_offset_coef);
                    return px;

                }
                function sonar__getOffsetLng_px(lng) {
                    let px = Math.round((lng - sonar__lng_min) / sonar__pulse_w_offset_coef);
                    return px;
                }

                function sonar__palettes() {
                    for (const color of sonar__colors_depth) {
                        const dv = '<div class="palette__item d-inline-block" style="background-color:' + color + '"></div>';
                        $('#sonar__palette_depth').append(dv);
                    }
                    for (const color of sonar__palette_power_rgb) {
                        const dv = '<div class="palette__item d-inline-block" style="background-color:' + color + '"></div>';
                        $('#sonar__palette_power_rgb').append(dv);
                    }
                    for (const color of sonar__palette_power_bw) {
                        const dv = '<div class="palette__item d-inline-block" style="background-color:' + color + '"></div>';
                        $('#sonar__palette_power_bw').append(dv);
                    }
                }

            </script>
        </main>
        <script src="jquery-3.6.0.min.js"></script>
        <script src="bootstrap.bundle.min.js"></script>
    </body>
</html>
<style>
    #sonar__section_block{
        width: 100%; 
        height: 130px; 
        overflow: scroll;
        position: relative;
        border: 1px solid #003580;        
    }

    #sonar__3D_block{ 
        width: 100%; 
        height: 420px; 
        overflow: scroll;
        position: relative;
        border: 1px solid #003580;             
    }

    .sonar__2D_pulseBottom{        
        display: block;
        float: left;        
        height: 8px;         
        position: absolute;                
        padding: 0;
        margin: 0;
        overflow: hidden;     
        z-index: 1;
    }
    .sonar__2D_pulse{     
        opacity: 1;
        background-color: black;       
        position: absolute;    
        padding: 0;
        margin: 0;      
        height: 4px;
    }     

    .palette__item {
        width: 6px;
        height: 20px;
        margin: 0;
        padding: 0;
    }

    .logic_pulsesOverBottom_block{
        display: block;
        float: left;        
        height: 100px; /*sonar__pulses_block_h_px*/             
        position: absolute;        
        z-index: 500;
        transform: rotate(45deg);
        padding: 0;
        margin: 0;
        overflow: hidden;
        z-index: 1;
    }
    .logic_pulsesOverBottom_block:hover{
        border-left: 1px solid red;
        border-right: 1px solid red;
        border-top: 1px solid red;        
        background-color: white;
        z-index: 600;        
    }
    .logic_pulseOverBottom{     
        opacity: 0.3;
        background-color: black;       
        position: absolute;    
        padding: 0;
        margin: 0;
        height: 2px;
    }     


    .logic_pulsesFull_block{
        display: block;
        float: left;        
        height: 100px; /*sonar__pulses_block_h_px*/
        box-shadow: 0px 8px 0px 0px black;     
        position: absolute;
        opacity: 0.4;
        z-index: 500;        
        padding: 0;
        margin: 0;
        transform: rotate(20deg);
        overflow: hidden;
        z-index: 1;
    }
    .logic_pulsesFull_block:hover{
        border-left: 1px solid red;
        border-right: 1px solid red;
        border-top: 1px solid red;
        opacity: 1;
        background-color: white;
        z-index: 600;       

    }
    .logic_pulseFull{   
        opacity: 0.1;
        background-color: grey;       
        position: absolute;    
        padding: 0;
        margin: 0;        
    }  

    .sonar__circles{        
        display: block;
        float: left;          
        position: absolute;
        opacity: 1;        
        padding: 0;
        margin: 0;        
    }
</style>